# Googleフォーム設定ガイド

## 1. Googleフォームの作成

Google Formsで新しいフォームを作成し、以下の質問を追加してください：

### 必須項目

1. **ユーザーID**
   - タイプ: 記述式
   - 必須: はい
   - 説明: 「任意のユーザーIDを入力してください（例: user001, taro_yamada など）。Rhinoプラグイン起動時にこのIDを入力します。」

2. **氏名**
   - タイプ: 記述式
   - 必須: はい
   - 説明: 「フルネームを入力してください」

3. **メールアドレス**
   - タイプ: 記述式
   - 必須: はい
   - 検証: メールアドレス形式

4. **所属**
   - タイプ: 記述式
   - 必須: いいえ
   - 説明: 「所属部署・組織名」

5. **研修開始日**
   - タイプ: 日付
   - 必須: はい

6. **研修終了日**
   - タイプ: 日付
   - 必須: はい

## 2. Google Apps Scriptの設定

1. Googleフォームを開く
2. 右上の「︙」（その他）→ 「スクリプト エディタ」をクリック
3. 表示されたエディタに `Code.gs` の内容を貼り付け
4. **重要**: `SERVER_URL` をGCP VMの外部IPアドレスに変更
   ```javascript
   const SERVER_URL = "http://34.xxx.xxx.xxx:5000/api/user/register";
   ```

## 3. トリガーの設定

1. スクリプトエディタで「トリガー」（時計アイコン）をクリック
2. 「トリガーを追加」をクリック
3. 以下のように設定：
   - 実行する関数: `onFormSubmit`
   - イベントのソース: `フォームから`
   - イベントの種類: `フォーム送信時`
4. 「保存」をクリック
5. 初回は権限の承認が必要です

## 4. テスト方法

### スクリプトの動作確認

1. スクリプトエディタで `testRegisterUser` 関数を選択
2. 「実行」ボタンをクリック
3. 「ログを表示」で結果を確認

### フォームからのテスト

1. フォームのプレビューを開く
2. テストデータを入力して送信
3. スクリプトエディタの「実行数」タブでログを確認
4. GCPサーバーのログも確認

## 5. フォームの配布

フォームが完成したら、以下の方法で受講者に配布：

1. フォーム右上の「送信」ボタンをクリック
2. リンクをコピーして受講者に共有
3. または、メールで直接送信

## 質問タイトルのカスタマイズ

`Code.gs` の質問判定ロジックは柔軟に対応できます。質問タイトルに以下のキーワードが含まれていれば自動認識します：

- **ユーザー名**: 「Windowsユーザー名」「ユーザー名」「Username」
- **氏名**: 「氏名」「名前」「Full Name」
- **メール**: 「メール」「Email」
- **所属**: 「所属」「Organization」
- **開始日**: 「開始日」「Start Date」
- **終了日**: 「終了日」「End Date」

質問タイトルを変更した場合は、これらのキーワードを含めるようにしてください。

## トラブルシューティング

### エラー: "Missing required fields"
- すべての必須項目が入力されているか確認
- 質問タイトルが正しいキーワードを含んでいるか確認

### エラー: "Server returned 500"
- GCPサーバーが起動しているか確認
- ファイアウォールが5000番ポートを許可しているか確認
- SERVER_URLが正しいか確認

### エラー: "User already exists"
- 既存ユーザーの情報が更新されます（エラーではありません）
